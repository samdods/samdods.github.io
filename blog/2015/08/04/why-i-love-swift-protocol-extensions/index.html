
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Why I Love Swift's Protocol Extensions - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="When protocol extensions were first mentioned at WWDC in June, they immediately stood out as a necessary feature. But it was only after I started &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://samdods.github.io/blog/2015/08/04/why-i-love-swift-protocol-extensions/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="samdods.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Why I Love Swift's Protocol Extensions</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-04T08:00:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>When protocol extensions were first mentioned at WWDC in June, they immediately stood out as a necessary feature. But it was only after I started playing around with them that I realised the true value these bring to the language.</p>

<!-- More -->


<h2>The problems in Objective-C that are somewhat solved by Swift</h2>

<h3>The ability to &ldquo;mix in&rdquo; functionality to classes</h3>

<p>When you want to extend a class in Objective-C, you would typically create a category on that class.</p>

<p>Say in my app I have defined the <code>Video</code>, <code>Photo</code> and <code>Song</code> classes, which have the shared superclass <code>MediaItem</code>.</p>

<p>Now I want to give each of these classes some functionality to make them <code>Shareable</code>. And I would expect this functionality to mostly be the same in each class.</p>

<p>Now you might suggest I implement the shareable functionality in their common superclass, and then somehow specify whether each one is shareable. But I might not want all future subclasses to inherit this functionality, and I may want to give this functionality to other classes that don&rsquo;t inherit from <code>MediaItem</code>. For example, I might want to make <code>UserProfile</code> shareable, so my users can share each other&rsquo;s profiles.</p>

<blockquote><p>With inheritance, you would typically follow the &ldquo;is a&rdquo; principle, meaning an object of your subclass type is an object of its superclass type and inherits common properties. For example, in real life, a <code>Dog</code> <em>is a</em> <code>Mammal</code> so it would make sense to inherit from the <code>Mammal</code> class.</p>

<p>A <code>Dog</code> should also be capable of other functionality, for example being able to <code>run</code>. It doesn&rsquo;t make sense to implement that functionality in the <code>Mammal</code> class, because it would not apply to the <code>Whale</code>, which is also a subclass of <code>Mammal</code>.</p>

<p>It doesn&rsquo;t make sense to have a <code>Runner</code> class for <code>Dog</code> to inherit from, because a <code>Dog</code> isn&rsquo;t necessarily a <code>Runner</code>, so the &ldquo;is a&rdquo; principle doesn&rsquo;t apply. Being able to <code>run</code> is a capability rather than a property.</p></blockquote>

<p>So how can I provide the <code>Shareable</code> functionality to my media classes without implementing it in each class individually? Well in Objective-C it simply isn&rsquo;t possible. Of course, you could add the shared functionality to a category on <code>NSObject</code>. But then (almost) all of your classes will inherit this functionality, which you don&rsquo;t want.</p>

<p>This is where Swift&rsquo;s protocol extensions come in handy. You could define the <code>Shareable</code> protocol like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">protocol</span> <span class="n">Shareable</span> <span class="p">{}</span>
</span><span class='line'><span class="k">extension</span> <span class="n">Shareable</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">share</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// common share functionality</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now any class that you declare as conforming to the <code>Shareable</code> protocol will &ldquo;adopt&rdquo; the sharing functionality. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">Photo</span><span class="p">:</span> <span class="n">MediaItem</span><span class="p">,</span> <span class="n">Shareable</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// func share() adopted from Shareable protocol</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">UserProfile</span><span class="p">:</span> <span class="n">Shareable</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// func share() adopted from Shareable protocol</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are familiar with Ruby, you will see the resemblence to what is known as a mixin.</p>

<h3>The requirement to check <code>respondsToSelector:</code></h3>

<p>For aeons people have been trying to work around this problem, for example Peter Steinberger&rsquo;s <a href="http://petersteinberger.com/blog/2013/smart-proxy-delegation/">Smart Proxy Delegation</a>. But all such solutions are only work arounds.</p>

<p>We all know that pure Swift protocols don&rsquo;t support optional methods. And Swift objects don&rsquo;t support <code>respondsToSelector</code>. But with protocol extensions, none of this matters!</p>

<p>We can simplify what used to be five rather ugly lines of Objective-C&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">BOOL</span> <span class="n">shouldBegin</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="kt">id</span><span class="o">&lt;</span><span class="n">DataServiceDelegate</span><span class="o">&gt;</span> <span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">delegate</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">delegate</span> <span class="nl">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">dataServiceShouldBeginSync</span><span class="p">:)])</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">shouldBegin</span> <span class="o">=</span> <span class="p">[</span><span class="n">delegate</span> <span class="nl">dataServiceShouldBeginSync</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; into a single line of Swift&hellip;</p>

<figure class='code'><figcaption><span>Swift</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">shouldBegin</span> <span class="o">=</span> <span class="n">delegate</span><span class="p">.</span><span class="n">dataServiceShouldBeginSync</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is acheived by defining the default implementation of this methods in an extension to the protocol, as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">DataServiceDelegate</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">dataServiceShouldBeginSync</span><span class="p">(</span><span class="nl">dataService</span><span class="p">:</span> <span class="n">DataService</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The additional beauty of this is that it makes the default behaviour explicitly clear to the consumer of your interface. No longer do they have to hunt around in possibly out-of-date documentation to figure out what will happen if they don&rsquo;t implement this methods themselves. And the default behaviour isn&rsquo;t hidden in the implementation.</p>

<h2>The additional powers of protocol extensions</h2>

<p>You can specify a &ldquo;where&rdquo; clause for your extension, so that only specific conforming classes adopt the functionality defined in the extension.</p>

<p>This allows us to define different default behaviour depending on the class that conforms to the protocol. For example, I could define the following protocol:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">protocol</span> <span class="n">Shareable</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">share</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I can specify that any object that conforms to this protocol should use the default behaviour as defined:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">Shareable</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">share</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;sharing something&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And I can specify that all media items have a different default behaviour:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">Shareable</span> <span class="k">where</span> <span class="nl">Self</span> <span class="p">:</span> <span class="n">MediaItem</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">share</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print</span><span class="p">(</span><span class="s">&quot;sharing a media item!&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note that this is not the same as providing this implementation in the <code>MediaItem</code> class, because this doesn&rsquo;t mean all <code>MediaItem</code> objects are <code>Shareable</code>. Only subclasses that conform to the <code>Shareable</code> protocol will pick up this functionality.</p></blockquote>

<p>This is demonstrated below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">UserProfile</span> <span class="p">:</span> <span class="n">Shareable</span> <span class="p">{}</span>
</span><span class='line'><span class="k">class</span> <span class="nl">AudioTrack</span> <span class="p">:</span> <span class="n">MediaItem</span><span class="p">,</span> <span class="n">Shareable</span> <span class="p">{}</span>
</span><span class='line'><span class="k">class</span> <span class="nl">Video</span> <span class="p">:</span> <span class="n">MediaItem</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">userProfile</span> <span class="o">=</span> <span class="n">UserProfile</span><span class="p">()</span>
</span><span class='line'><span class="n">userProfile</span><span class="p">.</span><span class="n">share</span><span class="p">()</span>
</span><span class='line'><span class="c1">// prints &quot;sharing something&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioTrack</span><span class="p">()</span>
</span><span class='line'><span class="n">audio</span><span class="p">.</span><span class="n">share</span><span class="p">()</span>
</span><span class='line'><span class="c1">// prints &quot;sharing a media item!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
</span><span class='line'><span class="n">video</span><span class="p">.</span><span class="n">share</span><span class="p">()</span>
</span><span class='line'><span class="c1">// results in a compiler error: value of type &#39;Video&#39; has no member &#39;share&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This also means that you can refer to <code>self</code> in the default implementation and access the properties of <code>self</code> with the knowledge that it is of a particular type. For example, the <code>MediaItem</code>  might have a <code>copyrightTerms</code> property, so I can use it in my default implementation as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">extension</span> <span class="n">Shareable</span> <span class="k">where</span> <span class="nl">Self</span> <span class="p">:</span> <span class="n">MediaItem</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">func</span> <span class="n">share</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">copyrightTerms</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// present the copyright terms to the user, asking them to accept before continuing.</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// complete share action without showing copyright terms.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>So are there any drawbacks?</h2>

<p>Like with so many language features: with great power comes great responsibility. And even more importantly, comes the greater need to fully understand how something works.</p>

<p>The methods in a protocol extension can also be implemented in the class that conforms to the protocol. The implementation in the class overrides the &ldquo;default&rdquo; implementation in the protocol extension. What&rsquo;s more is that if the implementation is added to the class in the form of a class extension, then it too overrides the protocol extension implementation. This can get very confusing if you are defining different implementations using the &ldquo;where&rdquo; syntax.</p>

<p>As more people become accustomed to writing Swift, I&rsquo;m sure the most common use for protocol extensions will be for the default implementation of &ldquo;optional&rdquo; delegate methods.</p>

<p>But for those that do use them as a kind of &ldquo;mixin&rdquo;, I&rsquo;d suggest erring on the side of caution and making your intent very clear.</p>

<h2>I hope you enjoyed reading</h2>

<p>If you enjoyed this article, please <a href="http://twitter.com/dodsios">follow me on twitter</a> or subscribe to my <a href="http://octopress.dev/atom.xml">RSS feed</a> for more of the same. Iâ€™m happy to discuss this or any other subject in more depth, so feel free to contact me!</p>

<p>And if you&rsquo;d like to join me at <a href="http://www.theappbusiness.com">The App Business</a> to work on some awesome projects for the biggest clients in each industry, then please get in touch &ndash; we&rsquo;re looking for great Swift and Objective-C developers.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      




<time class='entry-date' datetime='2015-08-04T08:00:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>, <a class='category' href='/blog/categories/osx/'>osx</a>, <a class='category' href='/blog/categories/swift/'>swift</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://samdods.github.io/blog/2015/08/04/why-i-love-swift-protocol-extensions/" data-via="" data-counturl="http://samdods.github.io/blog/2015/08/04/why-i-love-swift-protocol-extensions/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/05/02/stencil-xcode-plugin/" title="Previous Post: Introducing Stencil">&laquo; Introducing Stencil</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/09/21/some-swift-best-practices/" title="Next Post: Swift best practices (part i)">Swift best practices (part i) &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/21/some-swift-best-practices/">Swift Best Practices (Part I)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/04/why-i-love-swift-protocol-extensions/">Why I Love Swift's Protocol Extensions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/02/stencil-xcode-plugin/">Introducing Stencil</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/06/swift-alternatives-to-c-macros/">Swift Alternatives to C Macros (Part I)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/03/secondary-delegate/">How to Intercept Delegate Messages if You Are Not the Delegate</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
